# cloudflare ä¼˜é€‰æ­£ç¡®å§¿åŠ¿ï¼ï¼ï¼

> ä½œè€…ï¼šç«¯ç«¯/Gotchaaaï¼Œè½¬è½½è¯·æ ‡æ˜ä½œè€…ï¼Œæ„Ÿè°¢ï¼
> æ„Ÿè°¢è„šæœ¬çœŸæ­£æ ¸å¿ƒçš„å¼€æºé¡¹ç›®ï¼š[CloudflareSpeedTest](https://github.com/XIU2/CloudflareSpeedTest)

#### å¸®å‡ ä½pteråšäº†ä¸€ä¸‹ä¼˜é€‰ï¼Œå‘ç°å¾ˆå¤špterå®é™…ä¸Šä¼˜é€‰å§¿åŠ¿å¾ˆå·®åŠ²ğŸ˜… ï¼Œç‰¹æ­¤å‡ºè¿™ä¸ªæ•™ç¨‹ï¼Œæ–¹ä¾¿å¤§å®¶åœ¨PTè·¯ä¸Šèµ°çš„æ›´è½»æ¾
#### æ–°ç‰ˆæ•™ç¨‹é€‚ç”¨äº amd æˆ– arm æ¶æ„çš„ linux ç³»ç»Ÿ
#### æ—§ç‰ˆæ•™ç¨‹ä¸­ï¼Œarmæ¶æ„çš„è®¾å¤‡å¯ä»¥å»ç›´æ¥æ›¿æ¢æ‰ä¸‹é¢æ•™ç¨‹ä¸­çš„ amd çš„æ–‡ä»¶åï¼ˆamd64 -> arm64ï¼‰ï¼Œè§£å‹çš„æ—¶å€™æ³¨æ„ä¹Ÿæ›¿æ¢ä¸€ä¸‹æ–‡ä»¶å
#### å¦‚æœä½ ä½¿ç”¨äº†MPçš„ä¼˜é€‰ï¼Œè¯·å…³æ‰å®ƒï¼Œç¡®ä¿MPä¸ä¼šè¦†å†™ä½ çš„hostsæ–‡ä»¶
#### æˆ‘å°½é‡å†™å¾—è¯¦ç»†ä¸€äº›ï¼Œç”¨åˆ°çš„å‘½ä»¤ä¼šæ ‡å‡ºæ¥

## å¤§æ›´æ–°ï¼çœŸæ­£çš„è‡ªåŠ¨åŒ–
ä¸‹è½½ cfst.sh åˆ°ä»»æ„ç›®å½•ï¼Œå¦‚æœå‘½ä»¤è¡Œä¸‹è½½ä¸äº†ï¼Œè¯·å°è¯•å¦å¤–å‡ ä¸ªé•œåƒåœ°å€ï¼Œæˆ–è€…åˆ°æµè§ˆå™¨æ‰“å¼€è¿™ä¸ªé“¾æ¥ä¸‹è½½æºæ–‡ä»¶ï¼Œæ‰‹åŠ¨ä¼ åˆ°ä½ çš„è®¾å¤‡ä¸Š

```
wget https://raw.githubusercontent.com/vanchKong/cloudflare/refs/heads/main/cfst.sh
wget https://ghproxy.net/https://raw.githubusercontent.com/vanchKong/cloudflare/refs/heads/main/cfst.sh
wget https://gh-proxy.com/https://raw.githubusercontent.com/vanchKong/cloudflare/refs/heads/main/cfst.sh
wget https://ghfast.top/https://raw.githubusercontent.com/vanchKong/cloudflare/refs/heads/main/cfst.sh
wget https://ghproxy.com/https://raw.githubusercontent.com/vanchKong/cloudflare/refs/heads/main/cfst.sh
```

ç›´æ¥è¿è¡Œ `bash cfst.sh` å³å¯ï¼Œè„šæœ¬é»˜è®¤æœ‰ `UB` å’Œ `ZM`

åç»­å¢åŠ ç«™ç‚¹ï¼Œæˆ–è€…ä»»æ„ç½‘ç«™ï¼Œè·‘ä¸‹é¢çš„å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šè‡ªåŠ¨æ£€æµ‹ç½‘ç«™æ˜¯å¦æ‰˜ç®¡åœ¨CFä¸‹ï¼Œæ˜¯çš„æƒ…å†µä¸‹ä¼šè‡ªåŠ¨æ·»åŠ è®°å½•åˆ°hosts

`bash cfst.sh -add example.com`ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ `bash cfst.sh -add example1.com example2.com` æˆ– `bash cfst.sh -add example1.com,example2.com`ï¼Œåˆ é™¤åŒç†

å¦å¤–ï¼Œè¿˜æœ‰ç§»é™¤ä¼˜é€‰åŸŸåå‘½ä»¤ï¼š `bash cfst.sh -del example.com`ï¼Œå±•ç¤ºå½“å‰ä¼˜é€‰åˆ—è¡¨å‘½ä»¤ï¼š`bash cfst.sh -list`

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬çš„ï¼Œä¸è¦æ‰‹åŠ¨ä¿®æ”¹hostsæ–‡ä»¶ä¸­ä¼˜é€‰çš„è®°å½•ï¼Œéœ€è¦æ•²å‘½ä»¤æ¥å¢åŠ å’Œåˆ é™¤ï¼Œå¦‚æœä¸€å®šè¦æ‰‹åŠ¨çš„è¯ï¼Œè¯·ä¸€å¹¶åˆ é™¤ `/opt/CloudflareST/cfst_domains.conf` æ–‡ä»¶ä¸­ç›¸åº”çš„è®°å½•

ä¼˜é€‰å®Œæˆ–æ˜¯å¢åŠ åŸŸåæŒ‡å‘åï¼Œå¦‚æœä½ æ˜¯dockerå¯åŠ¨çš„ç›¸å…³æœåŠ¡ï¼Œè¯·é‡å¯å®¹å™¨ã€‚ä¼˜é€‰è¿™ä¸ªæ“ä½œä¸éœ€è¦å¾ˆé¢‘ç¹ï¼Œå¶å°”çœ‹çœ‹çº¢ç§æƒ…å†µï¼Œå‘ç°å¤§é¢ç§¯çº¢ç§äº†ï¼Œå°±å»ä¼˜é€‰ä¸€ä¸‹ï¼ˆä¸è¿‡ä¹Ÿå¯èƒ½è¢«è¿è¥å•†ç›´æ¥é˜»æ–­äº†ï¼‰ã€‚

--- 
<details>
  <summary>ä»¥ä¸‹æ˜¯æ—§ç‰ˆæ•™ç¨‹ï¼Œä¾ç„¶é€‚ç”¨ï¼Œä¸Šé¢çš„è„šæœ¬ä¹Ÿæ˜¯åœ¨åšå·®ä¸å¤šåŒæ ·çš„äº‹æƒ…</summary>

- ### å®‰è£… CloudflareST
> ä¸€èˆ¬æˆ‘ä¼šæŠŠå®ƒè£…åœ¨ /opt ç›®å½•ä¸‹ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„ä¹ æƒ¯æ¥ï¼ŒOKï¼Œé¦–å…ˆåˆ‡æ¢åˆ° opt ç›®å½•ã€åˆ›å»ºæ–‡ä»¶å¤¹
> 
> `cd /opt`
> 
> `mkdir CloudflareST && cd CloudflareST`
>
> ç„¶åä¸‹è½½CloudflareSTå‹ç¼©åŒ…
>
> `wget -N https://github.com/XIU2/CloudflareSpeedTest/releases/download/v2.2.5/CloudflareST_linux_amd64.tar.gz`
>
> å¦‚æœä½ æ˜¯åœ¨å›½å†…ç½‘ç»œç¯å¢ƒä¸­ä¸‹è½½ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨ä¸‹é¢è¿™å‡ ä¸ªé•œåƒåŠ é€Ÿä¹‹ä¸€ï¼š
>
> `wget -N https://ghp.ci/https://github.com/XIU2/CloudflareSpeedTest/releases/download/v2.2.5/CloudflareST_linux_amd64.tar.gz`
>
> `wget -N https://ghproxy.net/https://github.com/XIU2/CloudflareSpeedTest/releases/download/v2.2.5/CloudflareST_linux_amd64.tar.gz`
>
> `wget -N https://gh-proxy.com/https://github.com/XIU2/CloudflareSpeedTest/releases/download/v2.2.5/CloudflareST_linux_amd64.tar.gz`
> 
> `wget -N https://ghproxy.cc/https://github.com/XIU2/CloudflareSpeedTest/releases/download/v2.2.5/CloudflareST_linux_amd64.tar.gz`
>
> å¦‚æœä¸‹è½½å¤±è´¥çš„è¯ï¼Œå°è¯•åˆ é™¤ -N å‚æ•°ï¼ˆå¦‚æœæ˜¯ä¸ºäº†æ›´æ–°ï¼Œåˆ™è®°å¾—æå‰åˆ é™¤æ—§å‹ç¼©åŒ… `rm CloudflareST_linux_amd64.tar.gz` ï¼‰
>
> è§£å‹
>
> `tar -zxf CloudflareST_linux_amd64.tar.gz`
>
> èµ‹äºˆç›®å½•æ‰§è¡Œæƒé™
>
> `cd .. && chmod +x CloudflareST && cd CloudflareST`

- ### å¦‚ä½•åˆ¤æ–­å“ªäº›ç«™ç‚¹å¯ä»¥æ·»åŠ ä¼˜é€‰IPæŒ‡å‘
> ä»»æ„æ‰“å¼€ä¸€ä¸ªç«™ç‚¹ï¼Œæ‰“å¼€æ§åˆ¶å°åˆ‡æ¢è‡³ `ç½‘ç»œ/network` é€‰é¡¹ï¼Œä¿è¯ç­›é€‰å™¨é€‰æ‹©çš„æ˜¯ `å…¨éƒ¨`ï¼Œåˆ·æ–°ç½‘é¡µï¼Œåœ¨ `ç½‘ç»œ/network` é€‰é¡¹ç¿»åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œæ‰¾åˆ° `å“åº”æ ‡å¤´/Response Header`ï¼Œåœ¨é‡Œé¢æ‰¾ `server`ï¼Œå¦‚æœ `server` æ˜¯ `cloudflare`ï¼Œåˆ™ä»£è¡¨è¯¥åŸŸåå¯ä»¥æ·»åŠ åˆ° `hosts` æ–‡ä»¶å½“ä¸­ï¼ˆæ³¨æ„ï¼Œå½“å‰åœ°å€æ ä¸­æ˜¯äºŒçº§åŸŸåå°±æ·»åŠ äºŒçº§åŸŸåï¼Œæ˜¯é¡¶çº§åŸŸåå°±æ·»åŠ é¡¶çº§åŸŸåï¼Œä¸è¦è‡ªä½œèªæ˜ï¼‰ã€‚
> 
> å…³äºtrackerï¼šæœ‰äº›ç«™ç‚¹çš„ tracker æŒ‚é åœ¨cfä¸‹ï¼Œæœ‰äº›æ²¡æœ‰ï¼Œä½ å¯ä»¥æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªç§å­ä¸‹è½½ï¼ŒæŸ¥çœ‹å…·ä½“çš„ tracker åŸŸåæ˜¯ä»€ä¹ˆï¼ˆåŒæ ·ï¼Œæ˜¯äºŒçº§åŸŸåå°±å¤åˆ¶äºŒçº§åŸŸåï¼Œæ˜¯é¡¶çº§åŸŸåå°±å¤åˆ¶é¡¶çº§åŸŸåï¼‰ï¼Œå°†åŸŸåå¤åˆ¶ç²˜è´´åˆ°æµè§ˆå™¨æ‰“å¼€ï¼Œé‡å¤åˆšåˆšä¸Šé¢å¯¹äºç«™ç‚¹çš„æ­¥éª¤å³å¯ã€‚

- ### å‡†å¤‡ hosts åˆå§‹æ–‡ä»¶ï¼Œè¿™é‡Œä½ éœ€è¦ä¼šå¦‚ä½•åœ¨linuxä¸­ç¼–è¾‘ä¿å­˜æ–‡ä»¶
> ä½ éœ€è¦ç¼–è¾‘çš„æ–‡ä»¶æ˜¯ `/etc/hosts`ï¼Œä¸€èˆ¬å‘½ä»¤æ˜¯ `vi /etc/hosts`ï¼Œè¿›å…¥æ–‡ä»¶åï¼ŒæŒ‰ `i` è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼ŒæŒ‰ `Esc` é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œé€€å‡ºç¼–è¾‘æ¨¡å¼åæŒ‰ `:wq` ä¿å­˜é€€å‡ºï¼ŒæŒ‰ `:q!` ä¸ä¿å­˜å¼ºåˆ¶é€€å‡º
>
> å¦‚æœä½ ä¹‹å‰ä¼˜é€‰è¿‡ï¼Œä½†æ˜¯ä¸çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆæˆ–è€…æ¯”è¾ƒæ¨¡æ£±ä¸¤å¯ï¼Œå»ºè®®æ¸…ç©ºè‡ªå·±çš„ä¼˜é€‰ï¼ˆæ³¨æ„ï¼ä¸æ˜¯æ¸…ç©ºæ•´ä¸ªhostsæ–‡ä»¶ï¼‰ï¼Œä»¥ä¸‹åŸºäºä½ å·²ç»æ¸…ç©ºçš„æƒ…å†µ
>
> æ¯”å¦‚ä¸€ä¸ªç«™ç‚¹çš„åŸŸåæ˜¯ abc.comï¼Œç»è¿‡ä½ çš„æ£€æŸ¥ï¼Œå®ƒæŒ‚é åœ¨cfä¸‹ï¼Œä½ å¯ä»¥å…ˆéšä¾¿å†™ä¸ªipï¼Œç±»ä¼¼è¿™æ ·
>
> `1.1.1.1 abc.com`
>
> æ³¨æ„ä¸­é—´æ˜¯æœ‰ç©ºæ ¼çš„ï¼
>
> ä¸ºäº†æ–¹ä¾¿æ•´ç†ï¼Œæ‰“ä¸ªæ¯”æ–¹è¿™ä¸ªabcç«™ç‚¹çš„trackeråŸŸåæ˜¯ t.abc.comï¼Œä¸”åŒæ ·æŒ‚é åœ¨cfä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™
>
> `1.1.1.1 abc.com t.abc.com`

- ### æœ€åï¼Œå¼€å§‹ä¼˜é€‰
> `bash /opt/CloudflareST/cfst_hosts.sh`
>
> ç¬¬ä¸€æ¬¡è¿è¡Œæ­¤è„šæœ¬ï¼Œä¼šè®©ä½ å¡«å†™ä¸€ä¸ªipï¼Œè¯¥ipå°±å¡«å†™ä½ ä¹‹å‰éšä¾¿å†™çš„ä¸€ä¸ªipï¼Œè¿™é‡Œå°±å¡«å†™ `1.1.1.1`
>
> æ¥ä¸‹æ¥å°±ä¼šæ­£å¸¸è¿›è¡Œä¼˜é€‰ï¼Œå¹¶æ›¿æ¢æ‰æ‰€æœ‰å’Œä½ å¡«å†™ipåŒ¹é…çš„è®°å½•
>
> åç»­æ·»åŠ ç«™ç‚¹ï¼šç¡®è®¤å¥½åŸŸåæ˜¯æŒ‚é åœ¨cfä¸‹ä¹‹åï¼Œå°†è¯¥åŸŸåæ·»åŠ åˆ°hostsæ–‡ä»¶ï¼Œç¼–è¾‘ä¿å­˜å³å¯
>
> å¦‚æœä½ æ˜¯dockerå¯åŠ¨çš„qbã€trã€mpã€iyuuï¼Œä¼˜é€‰åï¼Œå»ºè®®é‡å¯è¿™äº›å®¹å™¨ã€‚ä¼˜é€‰å‘¨æœŸå…¶å®å¯ä»¥æ‹‰çš„å¾ˆé•¿ï¼Œæ‰€ä»¥é‡å¯ä¹Ÿä¸ä¼šå¾ˆé¢‘ç¹

</details>
